# 代码规范

**无规矩不成方圆 无规范不能协作**
众所周知，制订交通法规表面上是要限制行车权，实际上是保障公众的人身安全。试想如果没有限速，没有红绿灯，没有规定靠右行驶，谁还敢上路行驶。
同理，对软件来说，适当的规范和标准绝不是消灭代码内容的创造性、优雅性，而是限制过度个性化，以一种普遍认可的方式一起做事，降低故障率，提升协作效率。开发手册详细列举如何开发更加高效，更加容错，更加有协作性，力求知其然，更知其不然，结合正反例，提高代码质量。比如，异常日志处理时的各种不规范行为；集合转换的各种坑；创建线程池出现的等待队列OOM等。

**拥抱规范，远离伤害！**

## 阿里巴巴 Java 开发手册

《Java开发手册》是阿里巴巴集团技术团队的集体智慧结晶和经验总结，经历了多次大规模一线实战的检验及不断完善，公开到业界后，众多社区开发者踊跃参与，共同打磨完善，系统化地整理成册，当前的版本是嵩山版。

| 版本号 | 制定团队                     | 更新日期   | 备注                       |
| ------ | ---------------------------- | ---------- | -------------------------- |
| 1.7.0  | 阿里巴巴与全球Java社区开发者 | 2020.08.03 | 嵩山版，首次发布前后端规约 |



### 编程规约

#### 命名风格

1. **【强制】代码中的命名均不能以下划线或美元符号开始，也不能以下划线或美元符号结束。** 
   
   反例：`_name` /` __name` / `$name` / `name_` / `name$` / `name__`

   

2. **【强制】所有编程相关的命名严禁使用拼音与英文混合的方式，更不允许直接使用中文的方式。** 
   
   说明：正确的英文拼写和语法可以让阅读者易于理解，避免歧义。注意，纯拼音命名方式更要避免采用。 
   
   正例：ali / alibaba / taobao / cainiao/ aliyun/ youku / hangzhou 等国际通用的名称，可视同英文。 
   
   反例：DaZhePromotion [打折] / getPingfenByName() [评分] / String fw[福娃] / int 某变量 = 3 
   
   
   
3. **【强制】代码和注释中都要避免使用任何语言的种族歧视性词语。** 
   
   正例：日本人 / 印度人 / blockList / allowList / secondary  

   反例：RIBENGUIZI / Asan / blackList / whiteList / slave 

   
   
4. **【强制】类名使用UpperCamelCase风格，但以下情形例外：DO / BO / DTO / VO / AO / PO / UID等。** 

   正例：ForceCode    /    UserDO    /    HtmlDTO    /    XmlService    /    TcpUdpDeal  /  TaPromotion  

   反例：forcecode    /    UserDo    /    HTMLDto    /    XMLService    /    TCPUDPDeal  /  TAPromotion 

   

5. **【强制】方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase 风格。** 

   正例： localValue / getHttpMessage() / inputUserId 

   

6. **【强制】常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。** 

   正例：MAX_STOCK_COUNT / CACHE_EXPIRED_TIME 

   反例：MAX_COUNT / EXPIRED_TIME 

   

7. **【强制】抽象类命名使用Abstract或Base开头；异常类命名使用Exception结尾；测试类命名以它要测试的类的名称开始，以Test结尾。** 

   

8. **【强制】类型与中括号紧挨相连来表示数组。** 

   正例：定义整形数组int[] arrayDemo。 

   反例：在main参数中，使用String args[]来定义。 

   

9. **【强制】POJO类中的任何布尔类型的变量，都不要加is 前缀，否则部分框架解析会引起序列化错误。** 

   说明：在本文MySQL规约中的建表约定第一条，表达是与否的变量采用is_xxx的命名方式，所以，需要在`<resultMap>`设置从is_xxx到xxx的映射关系。 

   反例：定义为基本数据类型Boolean isDeleted 的属性，它的方法也是isDeleted()，框架在反向解析的时候，“误以为”对应的属性名称是deleted，导致属性获取不到，进而抛出异常。 

   

10. **【强制】包名统一使用小写，点分隔符之间有且仅有一个自然语义的英语单词。包名统一使用单数形式，但是类名如果有复数含义，类名可以使用复数形式。** 

    正例：应用工具类包名为com.alibaba.ei.kunlun.aap.util、类名为MessageUtils（此规则参考spring的框架结构） 

    

11. **【强制】避免在子父类的成员变量之间、或者不同代码块的局部变量之间采用完全相同的命名，使可理解性降低。** 

    说明：子类、父类成员变量名相同，即使是public类型的变量也能够通过编译，另外，局部变量在同一方法内的不同代码块中同名也是合法的，这些情况都要避免。对于非setter/getter的参数名称也要避免与成员变量名称相同。 

    ```
    反例： 
    public class ConfusingName { 
    public int stock; 
    
    // 非setter/getter的参数名称，不允许与本类成员变量同名 
    public void get(String alibaba) { 
        if (condition) { 
            final int money = 666; 
            // ... 
        } 
    
        for (int i = 0; i < 10; i++) { 
            // 在同一方法体中，不允许与其它代码块中的money命名相同 
            final int money = 15978; 
            // ... 
        } 
    } 
    } 
    
    class Son extends ConfusingName { 
        // 不允许与父类的成员变量名称相同 
        public int stock; 
    } 
    ```

    


12. **【强制】杜绝完全不规范的缩写，避免望文不知义。** 
    
    反例：AbstractClass“缩写”成AbsClass；condition“缩写”成 condi；Function缩写”成Fu，此类随意缩写严重降低了代码的可阅读性。 
    
    
    
13. **【推荐】为了达到代码自解释的目标，任何自定义编程元素在命名时，使用尽量完整的单词组合来表达。** 

    正例：对某个对象引用的volatile字段进行原子更新的类名为AtomicReferenceFieldUpdater。 

    反例：常见的方法内变量为int a;的定义方式。 

    

14. **【推荐】在常量与变量的命名时，表示类型的名词放在词尾，以提升辨识度。** 

    正例：startTime / workQueue / nameList / TERMINATED_THREAD_COUNT 

    反例：startedAt / QueueOfWork / listName / COUNT_TERMINATED_THREAD 

    

15. **【推荐】如果模块、接口、类、方法使用了设计模式，在命名时需体现出具体模式。** 

    说明：将设计模式体现在名字中，有利于阅读者快速理解架构设计理念。 

    正例：

    > public class OrderFactory; 
    >
    > public class LoginProxy; 
    >
    > public class ResourceObserver; 

    

16. **【推荐】接口类中的方法和属性不要加任何修饰符号（public 也不要加），保持代码的简洁性，并加上有效的Javadoc注释。尽量不要在接口里定义变量，如果一定要定义变量，确定与接口方法相关，并且是整个应用的基础常量。** 

    正例：接口方法签名 void commit(); 

      接口基础常量 String COMPANY = "alibaba"; 

    反例：接口方法定义 public abstract void f(); 

    说明：JDK8中接口允许有默认实现，那么这个default方法，是对所有实现类都有价值的默认实现。 

    

17. **接口和实现类的命名有两套规则**： 

     1）【强制】对于Service和DAO类，基于SOA的理念，暴露出来的服务一定是接口，内部的实现类用
    Impl的后缀与接口区别。 

    正例：CacheServiceImpl实现CacheService接口。 

     2）【推荐】如果是形容能力的接口名称，取对应的形容词为接口名（通常是–able的形容词）。 

    正例：AbstractTranslator实现 Translatable接口。 

    

18. **【参考】枚举类名带上Enum后缀，枚举成员名称需要全大写，单词间用下划线隔开。** 

    说明：枚举其实就是特殊的常量类，且构造方法被默认强制是私有。 

    正例：枚举名字为ProcessStatusEnum的成员名称：SUCCESS / UNKNOWN_REASON。 

    

19. 【参考】各层命名规约：  

    **A) Service/DAO层方法命名规约**

    - 获取单个对象的方法用get做前缀。 
    - 获取多个对象的方法用list 做前缀，复数结尾，如：listObjects。 
    - 获取统计值的方法用count做前缀。 
    - 插入的方法用save/insert 做前缀。 
    - 删除的方法用remove/delete做前缀。 
    - 修改的方法用update做前缀。 

    **B) 领域模型命名规约**

    - 数据对象：xxxDO，xxx即为数据表名。 
    - 数据传输对象：xxxDTO，xxx为业务领域相关的名称。 
    - 展示对象：xxxVO，xxx一般为网页名称。 
    - POJO是DO/DTO/BO/VO的统称，禁止命名成xxxPOJO。



#### 常量定义

1. **【强制】不允许任何魔法值（即未经预先定义的常量）直接出现在代码中。**  

   ```java
   // 本例中，开发者A定义了缓存的key，然后开发者B使用缓存时少了下划线，即key是"Id#taobao"+tradeId，导致出现故障 
   String key = "Id#taobao_" + tradeId; 
   cache.put(key, value); 
   ```
   
   
   
2. **【强制】在long或者Long赋值时，数值后使用大写字母L，不能是小写字母l，小写容易跟数字混淆，造成误解。** 

   说明：Long a = 2l; 写的是数字的21，还是Long型的2？ 

   

3. **【推荐】不要使用一个常量类维护所有常量，要按常量功能进行归类，分开维护。** 

   说明：大而全的常量类，杂乱无章，使用查找功能才能定位到修改的常量，不利于理解，也不利于维护。 

   正例：缓存相关常量放在类CacheConsts下；系统配置相关常量放在类SystemConfigConsts下。 

   

4. **【推荐】常量的复用层次有五层：跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。** 

   - 跨应用共享常量：放置在二方库中，通常是client.jar中的constant目录下。 

   - 应用内共享常量：放置在一方库中，通常是子模块中的constant目录下。 

     > 反例：易懂变量也要统一定义成应用内共享常量，两位工程师在两个类中分别定义了“YES”的变量： 
     > 类A中：public static final String YES = "yes"; 
     > 类B中：public static final String YES = "y"; 
     > A.YES.equals(B.YES)，预期是true，但实际返回为false，导致线上问题。 

   - 子工程内部共享常量：即在当前子工程的constant目录下。 

   - 包内共享常量：即在当前包下单独的constant目录下。 

   - 类内共享常量：直接在类内部private static final定义。 

   

5. **【推荐】如果变量值仅在一个固定范围内变化用enum类型来定义。** 

   说明：如果存在名称之外的延伸属性应使用enum类型，下面正例中的数字就是延伸信息，表示一年中的第几个季节。 

   ```java
   正例： 
   public enum SeasonEnum { 
   SPRING(1), SUMMER(2), AUTUMN(3), WINTER(4); 
   private int seq; 
   SeasonEnum(int seq) { 
       this.seq = seq; 
   } 
   public int getSeq() { 
       return seq; 
   } 
   }
   ```

   

#### 代码格式

1. **【强制】如果是大括号内为空，则简洁地写成{}即可，大括号中间无需换行和空格；**如果是非空代码块则： 

   1） 左大括号前不换行。 

   2） 左大括号后换行。 

   3） 右大括号前换行。 

   4） 右大括号后还有else等代码则不换行；表示终止的右大括号后必须换行。 



2. **【强制】左小括号和右边相邻字符之间不出现空格；右小括号和左边相邻字符之间也不出现空格；而左大括号前需要加空格。**详见第5条下方正例提示。  

   反例：if (空格a == b空格)  



3.  **【强制】if/for/while/switch/do 等保留字与括号之间都必须加空格。** 



4. **【强制】任何二目、三目运算符的左右两边都需要加一个空格。** 

   说明：包括赋值运算符=、逻辑运算符&&、加减乘除符号等。 



5. **【强制】采用4个空格缩进，禁止使用Tab字符。** 

    说明：如果使用Tab缩进，必须设置1个Tab为4个空格。IDEA设置Tab为4个空格时，请勿勾选Use tab character；而在Eclipse中，必须勾选insert spaces for tabs。

  ```java
  //正例： （涉及1-5点） 
  public static void main(String[] args) { 
      // 缩进4个空格 
      String say = "hello"; 
      // 运算符的左右必须有一个空格 
      int flag = 0; 
      // 关键词if 与括号之间必须有一个空格，括号内的f与左括号，0与右括号不需要空格 
      if (flag == 0) { 
          System.out.println(say); 
      } 
      // 左大括号前加空格且不换行；左大括号后换行 
      if (flag == 1) { 
          System.out.println("world"); 
          // 右大括号前换行，右大括号后有else，不用换行 
      } else { 
          System.out.println("ok"); 
          // 在右大括号后直接结束，则必须换行 
      } 
  }
  ```




6. **【强制】注释的双斜线与注释内容之间有且仅有一个空格。** 

   正例：  
   // 这是示例注释，请注意在双斜线之后有一个空格 
   String commentString = new String(); 



7. **【强制】在进行类型强制转换时，右括号与强制转换值之间不需要任何空格隔开。** 

   正例： 
   double first = 3.2d; 
   int second = (int)first + 2;    



8.  **【强制】单行字符数限制不超过120个，超出需要换行，换行时遵循如下原则：** 
    
    - 第二行相对第一行缩进4个空格，从第三行开始，不再继续缩进，参考示例。 
    - 运算符与下文一起换行。 
    - 方法调用的点符号与下文一起换行。 
    - 方法调用中的多个参数需要换行时，在逗号后进行。 
	- 在括号前不要换行，见反例。 
	
	```java
	正例： 
	StringBuilder sb = new StringBuilder(); 
	// 超过120个字符的情况下，换行缩进4个空格，并且方法前的点号一起换行  
	sb.append("yang").append("hao")... 
	        .append("chen")... 
	        .append("chen")... 
	        .append("chen"); 
	```
	
	```java
	反例： 
	StringBuilder sb = new StringBuilder(); 
	// 超过120个字符的情况下，不要在括号前换行   
	sb.append("you").append("are")...append 
	    ("lucky"); 
	 
	// 参数很多的方法调用可能超过120个字符，逗号后才是换行处  
	method(args1, args2, args3, ... 
	    , argsX);
	```
	
	

9. **【强制】方法参数在定义和传入时，多个参数逗号后面必须加空格。** 

   正例：下例中实参的args1，后边必须要有一个空格。 method(args1,  args2,  args3);  



10. **【强制】IDE的text file encoding设置为UTF-8; IDE中文件的换行符使用Unix格式，不要使用Windows格式。** 



11. **【推荐】单个方法的总行数不超过80行。** 

    说明：除注释之外的方法签名、左右大括号、方法内代码、空行、回车及任何不可见字符的总行数不超过80行。 

    正例：代码逻辑分清红花和绿叶，个性和共性，绿叶逻辑单独出来成为额外方法，使主干代码更加清晰；共性逻辑抽取成为共性方法，便于复用和维护。 



12. **【推荐】没有必要增加若干空格来使变量的赋值等号与上一行对应位置的等号对齐。** 

    ```java
    正例： 
    int one = 1; 
    long two = 2L; 
    float three = 3F; 
    StringBuilder sb = new StringBuilder(); 
    // 说明：增加sb这个变量，如果需要对齐，则给one、two、three都要增加几个空格，在变量比较多的情况下，是非常累赘的事情。 
    ```

    

13. **【推荐】不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性。** 

    说明：任何情形，没有必要插入多个空行进行隔开。



