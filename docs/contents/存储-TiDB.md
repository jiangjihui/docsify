# TiDB

## 简介

TiDB（tidb）是一个开源的 NewSQL 数据库，它在设计上兼容 MySQL 协议，支持水平扩展（scale-out），具备分布式事务处理能力，并且能够实现实时分析处理（HTAP, Hybrid Transactional and Analytical Processing）。TiDB 是一个由 PingCAP 公司开发的项目，它旨在解决大规模数据存储和处理的问题，同时保持高性能、高可用性和强一致性。

### 发展历程

- TiDB 的设计灵感来源于 Google 的 Spanner/F1 论文。著名的开源分布式缓存服务 Codis 的作者、PingCAP 联合创始人 & CTO 黄东旭看到这两篇论文后，受到启发，在此基础上诞生了 TiDB。
- 自 2017 年 10 月 15 日首次发布以来，TiDB 不断迭代更新，截至 2023 年 10 月已发布 7.4.0 稳定版本。



### 特性

- **水平可扩展性**：TiDB 可以通过增加更多的机器来提升系统的整体性能和存储容量，而不需要对现有的架构进行大的改动。
- **分布式事务**：TiDB 支持 ACID 事务特性，确保了数据的一致性和完整性。
- **高可用性**：通过多副本机制和自动故障转移来保证服务的连续性和数据的安全性。
- **兼容 MySQL 协议**：使得迁移和集成相对简单，因为很多应用程序已经熟悉 MySQL 的使用方式。
- **实时分析处理（HTAP）**：TiDB 能够在一个系统中同时支持在线事务处理（OLTP）和在线分析处理（OLAP）的需求。
- **SQL 引擎**：支持标准 SQL 查询语言，方便用户进行数据查询和操作。
- **分布式架构**：TiDB 使用 TiKV 作为其分布式 key-value 存储引擎。TiKV 不仅支持 TiDB，还是一个独立的项目，可以为其他应用提供存储服务。



### 架构

TiDB 的架构主要包括以下几个组件：

- **TiDB Server (SQL 层)**：处理 SQL 查询，执行 SQL 计划，并返回结果给客户端。
- **TiKV Server (Key-Value 存储)**：作为分布式数据库的核心存储层，支持事务性的 key-value 操作。
- **PD (Placement Driver)**：集群状态管理器，负责存储集群的元数据信息、监控集群状态、负载均衡和调度等功能。并且提供了全局的服务发现功能。



### 与MySQL的区别

TiDB 和 MySQL 存在多方面的区别，主要体现在以下几个方面：

#### 一、架构

- **MySQL**：**传统单机或主从复制架构**。单机时所有操作在一个服务器；主从复制是主节点写、从节点读来实现读写分离与部分负载均衡，大规模高并发时易有性能瓶颈。
- **TiDB**：**分布式架构**。含计算层、存储层和协调层。计算层处理 SQL 逻辑；存储层持久化存储且数据自动分片分布多节点；协调层管理集群，可应对高并发海量数据，水平扩展能力强。

#### 二、存储引擎

- **MySQL**：有 InnoDB、MyISAM 等多种存储引擎可选。InnoDB 默认，支持事务和行级锁；MyISAM 无事务但查询性能高，不同引擎适用于不同场景。
- **TiDB**：有 TiKV（默认分布式键值存储引擎，自动负载均衡与故障转移）和 TiFlash（列存储引擎，加速分析型查询）。

#### 三、事务处理

- **MySQL**：支持事务处理，InnoDB 引擎提供了完整的 ACID 事务特性，保证了事务的原子性、一致性、隔离性和持久性。但在分布式场景下，MySQL 的事务处理能力相对较弱，需要借助外部的中间件或复杂的技术手段来实现分布式事务。
- **TiDB**：实现了**分布式事务**，并且支持强一致性。在数据复制到所有节点之前，无论集群中的哪个节点发生故障，都不会丢失任何数据。TiDB 内部通过两阶段提交等机制确保分布式事务的正确执行，大大简化了分布式系统中事务处理的复杂性。

#### 四、数据存储与分区

- **MySQL**：数据以表形式存于磁盘，大规模数据需分区表技术（范围、列表、哈希分区等），分区管理维护复杂。
- **TiDB**：数据以 region 形式存储，自动分片复制，默认情况下会为同一份数据维护 3 个副本，无需手动分区管理。

#### 五、性能表现

- **MySQL**：单机性能好，小规模低并发稳定，但高并发大规模数据时受架构限制。
- **TiDB**：分布式架构多节点并行处理，高并发海量数据性能佳，可增加节点提升能力。

#### 六、SQL 语法和功能支持

- **SQL 语法**：TiDB 尽量兼容 MySQL，但有细节差异（建表、临时表、函数等方面）。
- **功能支持**：TiDB 除传统功能外有分布式特性功能（分布式事务、跨节点查询连接），MySQL 在这方面较弱。

#### 七、运维和管理

- **MySQL**：小规模部署运维简单，大规模集群管理扩展需复杂配置（主从复制、读写分离等）。
- **TiDB**：分布式使其运维管理较复杂，但有工具（如 TiUP）方便部署、升级和维护。
